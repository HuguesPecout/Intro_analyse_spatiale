---
title: "Introduction √† l'analyse spatiale"
subtitle: "Master II G√©omatique, USSEIN"
author: "Hugues Pecout"
institute: UMR8504 G√©ographie-Cit√©s 
img : img/cnrs.png
title-slide-attributes:
  data-background-image: img/USSEIN.png
  data-background-size: 8%
  data-background-position: 2% 2%
footer: "Master II G√©omatique, USSEIN, le 13 mai 2025"
  
format: 
  revealjs:
    template-partials:
      - title-slide.html
    fig-align: center
    smaller: TRUE
    theme : [custom.scss]
    show-slide-number: all
    slide-number: TRUE
    code-line-numbers: FALSE
    chalkboard: TRUE
    transition: fade
    transition-speed: fast
    menu: TRUE

execute:
  echo: true
  output: true
  warning: true
  include: true
  cache: true

date: 23 05 2024
date-format: "D MMM YYYY"
lang: fr
logo: "img/USSEIN.png"
css: style.css

---

## Analyse spatiale ?

\

> ¬´ *Analyse formalis√©e de la configuration et des propri√©t√©s de l‚Äôespace g√©ographique, tel qu‚Äôil est produit et v√©cu par les soci√©t√©s humaines.* ¬ª
>
> Pumain D., Saint-Julien Th., 2010, Analyse spatiale - Localisations. Paris, Colin, Cursus, 162p

\

> Une d√©marche ¬´ *qui met l‚Äôaccent sur l‚Äôidentification de formes ou de structures spatiales, sur les relations entre les objets g√©ographiques, sur les processus de changement.* ¬ª
>
> Feuillet et al., 2019

\

:::{.center}

L‚Äôanalyse spatiale est l‚Äô**ensemble de th√©ories et de m√©thodes permettant d‚Äôexplorer, de mod√©liser et d‚Äôinterpr√©ter des ph√©nom√®nes en tenant compte de leur localisation g√©ographique et des relations spatiales entre entit√©s**.

&rarr; Approche **hypoth√©tico-d√©ductive** (d√©marche nomoth√©tique).

:::


## Les fondamentaux

::::{.columns}

:::{.column width="100%"}

**L'analyse spatiale :**

- S‚Äôappuie sur des **donn√©es g√©or√©f√©renc√©es** (avec des coordonn√©es dans l‚Äôespace);
- Cherche √† **d√©tecter des structures spatiales** (clusters, gradients, ruptures);
- Mobilise des outils de **statistique, g√©omatique et mod√©lisation**.
    
:::

::::

   
::::{.columns}
    
:::{.column width="25%"}

![](img/js.png)
:::

:::{.column width="5%"}

:::

:::{.column width="70%" }

:::{.center style="margin-top:30px;"}

**Un exemple historique** : √âpid√©mie de chol√©ra (1854)

:::

:::{.soixantedix}

 \

John Snow est un m√©decin britannique. Ces travaux sur la propagation du chol√©ra dans le quartier de Soho √† Londres en 1854 lui ont valu une place importante dans l'histoire de l'√©pid√©miologie et de l'analyse spatiale.

:::

:::{columns}

:::{.column width="60%" .soixantedix}


\

**Carte de J. Snow** indiquant les d√©c√®s chol√©riques (points) survenus en ao√ªt et septembre 1854 dans le quartier de Soho &rarr; 

\
\

**John Snow va identifier la cause de l'√©pid√©mie de chol√©ra en utilisant un proc√©d√© simple, mais innovant, qui repose sur le principe de fonctionnement de l'analyse spatiale...**



:::

:::{.column width="5%" }

:::


:::{.column width="30%" }

![](img/carte_js.png)
:::





:::


:::

::::


## Un exemple historique : √âpid√©mie de chol√©ra


::::{.columns}

:::{.column width="60%"}

![](img/plan_js.jpg)

:::

:::{.column width="40%"}

:::{style="margin-top:50px;"}

John Snow va mettre en relation plusieurs couches d‚Äôinformation g√©ographiques :

- Un **plan du quartier** (rues)   
- La **localisation des d√©c√®s** (r√©sidence)   
- La **localisation des pompes √† eau**   

:::

\

![](img/zoom_js.jpg)

:::


::::


## Un exemple historique : √âpid√©mie de chol√©ra

**Cette mise en relation va lui permettre d'√©mettre une hypoth√®se sur la cause de l‚Äô√©pid√©mie.**


::::{.columns}

:::{.column width="60%"}

![](img/simplify_js.png)

:::

:::{.column width="40%" .soixante}

\

D√©tail de la deuxi√®me carte par points de Snow montrant l‚Äô**ajout de la ligne d‚Äô√©quidistance**. Cholera Inquiry Committee, *Report on the Cholera Outbreak in the Parish of St. James, Westminster during the Autumn of 1854*, Londres, Churchill, 1855, pp. 106-107.

:::{.center}

![](img/equidistance.png)
:::

:::

::::



## Un exemple historique : √âpid√©mie de chol√©ra {.scrollable}

**Si John Snow avait utilis√© un syst√®me d‚Äôinformation g√©ographique‚Ä¶.**

::::{.columns}

:::{.column width="57%"}

![](img/pop_js.png)

:::

:::{.column width="43%"}

![](img/potential_js.gif)

:::

::::

::::{.columns}

:::{.column width="47%"}

![](img/voronoi_js.png)


:::

:::{.column width="53%"}

![](img/star_js.png)

:::

::::



## Pourquoi faire ? 

\

- [**Comprendre la distribution des ph√©nom√®nes**]{.bigbis}   
Ex : R√©partition et diffusion des maladies infectieuses

- [**D√©tecter des relations spatiales**]{.bigbis}   
Ex : Prix immobiliers vs proximit√© spatiales

- [**Prendre en compte l‚Äôeffet d‚Äô√©chelle et le contexte spatial**]{.bigbis}   
Ex : Le ch√¥mage peut para√Ætre homog√®ne √† l‚Äô√©chelle r√©gionale mais tr√®s contrast√© √† l‚Äô√©chelle communale.

- [**Aller au-del√† des analyses classiques**]{.bigbis}   
Ex : Des quartiers avec le m√™me taux de criminalit√© peuvent avoir des dynamiques spatiales diff√©rentes (dispersion vs concentration).

- [**Aider √† la prise de d√©cision**]{.bigbis}   
Ex : Localisation d'un poste de secours


:::{.center .bigbis}

**Analyser l‚Äôespace, c‚Äôest mieux comprendre, mieux expliquer et mieux agir sur les ph√©nom√®nes complexes du monde r√©el.**

:::


## Analyse spatiale ‚â† g√©omatique 

\
\


:::{.center .bigquat}

[**Analyse spatiale**]{.colour3 .bigbis}

=

[Concept de la g√©ographie]{.colour}  
 +   
[Statistique(s)]{.colour}   
+    
[Cartographie]{.colour}     
+    
[Outils de la g√©omatique]{.colour3}     


:::



## Notions th√©oriques fondamentales (I)

:::{.columns .bigbis}

:::{.column width="81%"}


**1er loi de la g√©ographie** de [Waldo Tobler](https://fr.wikipedia.org/wiki/Waldo_Tobler) (1970)


> ¬´ *Tout est li√© √† tout, mais les choses proches sont plus li√©es que les choses √©loign√©es.* ¬ª


**Loi fondamentale** en analyse spatiale qui justifie l'utilisation d'outils qui prennent en compte l‚Äôemplacement.

:::

:::{.column width="19%"}

![](img/Waldo_Tobler_2007.jpg)

:::

:::

:::{.bigbis}


**Les ph√©nom√®nes g√©ographiques sont spatialement auto-corr√©l√©s**. La proximit√© spatiale implique souvent une similarit√© : **plus deux objets sont proches, plus ils ont de chances de partager des caract√©ristiques.**

\

üëâ Les prix de l‚Äôimmobilier varient plus en fonction de la proximit√© imm√©diate que de tendances globales...

:::

## Notions th√©oriques fondamentales (II)


:::{.columns .bigbis}

:::{.column width="81%"}


**2·µâ loi de Tobler** (1999, moins formelle)

> ¬´ *Le ph√©nom√®ne spatial est plus int√©ressant lorsqu‚Äôil ne suit pas la premi√®re loi de Tobler.* ¬ª

Sans prendre en compte cette 2·µâ loi, on risquerait d'appliquer des interpolations ou des mod√®les inadapt√©s.


:::

:::{.column width="19%"}

![](img/Waldo_Tobler_2007.jpg)

:::

:::

:::{.bigbis}

La plupart des ph√©nom√®nes varient de mani√®re continue dans l‚Äôespace (ex : temp√©rature, densit√© de population‚Ä¶). Mais **des discontinuit√©s existent** (ex : falaises, rivi√®res, fronti√®res administratives). Cette loi est un rappel que **l‚Äôespace n'est pas toujours homog√®ne ni sans rupture**.

\

üëâ Deux quartiers voisins mais tr√®s diff√©rents : Riche et faiblement peupl√© vs pauvre et dense


:::



## Concepts et m√©thodes en analyse spatiale

:::{.bigbis}

On peut appliquer diff√©rents concepts et m√©thodes d‚Äôanalyse spatiale en fonction de la nature des donn√©es √©tudi√©es. Par exemple  :

\

- **Lieux et semis de points (donn√©es ponctuelles)** : mesure de centre, de la dispersion, de concentration, de forme, de distance, de densit√©, d‚Äôinterpolation, de potentiel‚Ä¶

- **Lien et r√©seau (donn√©es lin√©aires)** : analyse de r√©seau/graphe‚Ä¶

- **Surfaces et r√©gions (donn√©es surfaciques)** : analyse de l‚Äôh√©t√©rog√©n√©it√©, de homog√©n√©it√©, calcul des discontinuit√©s, de l‚Äôautocorr√©lation, discr√©tisation spatiale et r√©gionalisation‚Ä¶

- **Interaction spatiale (matrice de flux)** :  (mod√©lisation, flux dominants‚Ä¶)

\

**La  transformation g√©om√©trique des donn√©es √©tudi√©es et le changement d'√©chelle sont des √©tapes r√©currentes en analyse spatiale.**

:::


## Analyse spatiale (avec R) {.scrollable}

\

::: columns
::: {.column width="50%"}

**Packages indispensables :**

-   `sf` : Manipulation de vecteur, g√©otraitements
-   `terra` : Manipulation de raster, g√©otraitements
-   `mapsf` : Cartographie th√©matique

\

Package pour l'**analyse de r√©seau** :

-   `igraph` : Analyse de r√©seaux
-   `sfnetworks` : Analyse des r√©seaux g√©ospatiaux
-   `stplanr` : Planification et de mod√©lisation des transports
:::



::: {.column width="50%"}

Divers packages pour l'**analyse spatiale** :

-   `spatstat` : Analyse statistique de semis de points
-   `gstat` : Variogram et Krigeage
-   `rgeoda` : Geoda avec R
-   `GWmodel`, `spgwr` : Geographically Weighted Models
-   `potential` : Mod√®le des potentiels de Stewart.
-   `mapiso` : Conversion Raster vers polygone
-   `valh` : Service de routage (OpenStreetMap)
-   `osrm` : Service de routage (OpenStreetMap)
-   `distanamo` : Cr√©ation de cartogrammes de distance
-   `...`


:::
:::

\


<center>
[**Exemple : analyse d'un semis de points**]{.bigquat}
</center>

\

[**A. Collecte de donn√©es OpenStreetMap**]{.bigone}


```{r}
#| eval: true
#| message: false
#| warning: false
#| code-fold: true

library(sf)
library(osmdata)
library(mapsf)

bbox_avignon <- getbb("Paris")
semis_points <-  bbox_avignon |> 
  opq(osm_types = "node")|>
  add_osm_feature(key = 'amenity', value = "restaurant") |>
  osmdata_sf() |>
  _$osm_points |>
  st_transform("EPSG:3857") |>
  mf_map(cex = 1)
```

\

[**B. R√©partition du semis de point dans un maillage territorial**]{.bigone}

```{r}
#| code-fold: true
#| eval: true
#| message: false
#| warning: false

# Import du d√©coupage IRIS
iris <- st_read("data/paris.gpkg", layer = "IRIS", quiet = TRUE)

# Intersection poitn / maillage
inter <- st_intersects(iris, semis_points, sparse = TRUE)

# Nb de restaurant par IRIS
iris$nb_restaurant <- lengths(inter)

# Affichage
mf_map(iris, var = "nb_restaurant", type = "choro")

```

\

[**C. R√©partition du semis de point dans une grille r√©guli√®re**]{.bigone}

```{r}
#| code-fold: true
#| cache: true
#| eval: true
#| message: false
#| warning: false

# Cr√©ation de la grille r√©guli√©re
grid <- st_make_grid(x = semis_points, cellsize = 500)

# Ajout d'un identifiant unique
grid <- st_sf(ID = 1:length(grid), geom = grid)


# Intersection points / grille
inter2 <- st_intersects(grid, semis_points, sparse = TRUE)

# Nombre de restaurants par carreau
grid$nb_restaurant <- lengths(inter2)

# Affichage
mf_map(grid, var = "nb_restaurant", 
       type = "choro", 
       breaks=c(0,1,5,10,20,40,max(grid$nb_restaurant)))

```


\

[**D. Densit√© (continue) d'un semis par la m√©thode de lissage par noyaux (KDE) :**]{.bigone}

```{r}
#| code-fold: true
#| cache: true
#| message: false
#| warning: false
library(sf)
library(spatstat)

# Conversion du semi de point en objet "ppp"
p <- as.ppp(X = st_coordinates(semis_points), 
            W = as.owin(st_bbox(semis_points)))

# Calcul de la densit√© (KDE)
ds <- density.ppp(x = p, 
                  sigma = 300, 
                  eps = 10, 
                  positive = TRUE)

# Affichage
plot(ds)


```



\


**Conversion de l'objet cr√©e (`img`, package `spatstat`) en objet `SpatRaster` (package `terra`) :**



```{r}
#| code-fold: true
#| cache: false
#| message: false
library(terra)

# densit√© en restaurants / hectares
r <- rast(ds) * 100 * 100

# Assignation de la projection
crs(r) <- sf::st_crs(semis_points)$wkt

# Affichage 
plot(r)

```

\

**Transformation du Raster (`SpatRaster`) et polygone vectoriel (`sf`) :**


```{r}
#| code-fold: true
#| cache: false
#| warning: false


library(mapiso)

# Limites des classes
maxval <- max(terra::values(r))
bks <-  c(seq(0, floor(maxval), 0.5), maxval)

# Transformation du raster en polygones
iso_dens <- mapiso(r, breaks = bks)

# Suppression de la premi√®re classe ([0, 1[)
iso_dens <- iso_dens[-1, ]

# Affichage
mapsf::mf_raster(r)
mapsf::mf_map(iso_dens, col = NA, add = TRUE)

```

\

[**E. Densit√© (discr√™te) - M√©thode des polygones de vorono√Ø :**]{.bigone}

```{r}
#| code-fold: true
#| cache: true
#| warning: false

Poly_voronoi <- semis_points |> 
                  st_union() |> 
                  st_voronoi() |> 
                  st_collection_extract("POLYGON") |> 
                  st_intersection(iris) |> 
                  st_sf() |> 
                  st_join(semis_points, st_intersects) |>
                  st_cast("MULTIPOLYGON") 

# Affichage
mf_map(x=Poly_voronoi,
       lwd=0.2, 
       border ="grey40")

```

\

**Calcul de la simili densit√©**

```{r}
#| code-fold: true
#| cache: true
#| warning: false

# Calcul simili densit√©
Poly_voronoi$area <- st_area(Poly_voronoi)
Poly_voronoi$dens <- 1 / Poly_voronoi$area * 10000

# Affichage densit√© discr√®te
mf_map(x=Poly_voronoi, var="dens", type="choro", border =NA)

```


